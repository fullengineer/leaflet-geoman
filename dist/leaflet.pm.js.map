{"version":3,"sources":["L.PM.js","L.PM.Draw.js","js/L.Controls.js","js/L.PM.Draw.Poly.js","js/L.PM.Edit.Poly.js","js/L.PM.LayerGroup.js"],"names":["L","PM","initialize","initLayerGroup","pm","Edit","LayerGroup","addInitHook","initPolygon","Poly","Polygon","initMap","Draw","Map","Class","extend","map","_map","shapes","i","length","shape","getShapes","enableDraw","join","disableDraw","enable","disable","addControls","addButton","Control","PMButton","options","position","_button","setButton","onAdd","container","DomUtil","create","_container","_makeButton","onRemove","button","className","iconUrl","onClick","afterClick","doToggle","toggleStatus","getText","text","getIconUrl","destroy","_update","toggle","e","toggled","onCreate","newButton","addClass","image","setAttribute","DomEvent","addListener","_clicked","disableClickPropagation","removeClass","childNodes","_shape","_enabled","_layerGroup","addTo","_polyline","polyline","color","addLayer","_hintline","dashArray","style","cursor","on","_createPolygonPoint","_syncHintLine","fire","off","removeLayer","enabled","self","drawPolyButton","_drawButton","polyPoints","getLatLngs","lastPolygonPoint","setLatLngs","latlng","first","addLatLng","_createMarker","_finishPolygon","coords","polygonLayer","polygon","toggleEdit","layer","marker","Marker","draggable","icon","divIcon","poly","_poly","_markerGroup","_initMarkers","_initDraggableLayer","dragging","el","_path","_dragging","that","_tempDragCoord","event","_onLayerDrag","_fireEdit","window","setTimeout","deltaLatLng","lat","lng","_markers","currentLatLng","getLatLng","newLatLng","setLatLng","_onMarkerDrag","target","_latlngs","push","k","nextIndex","_createMiddleMarker","index","_origLatLng","_index","_onMarkerDragEnd","_removeMarker","leftM","rightM","_calcMiddleLatLng","middleMarker","setIcon","_middleMarkerRight","_middleMarkerLeft","_addMarker","newM","splice","undefined","redraw","leftMarkerIndex","rightMarkerIndex","nextMarkerIndex","prevMarkerIndex","_latlng","middleMarkerRightLatLng","middleMarkerLeftLatLng","edited","p1","project","p2","unproject","_add","_divideBy","layerGroup","_layers","getLayers","fireEvent"],"mappings":"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","file":"leaflet.pm.js","sourcesContent":["/**\n*\n* A Leaflet Plugin For Editing Geometry Layers in Leaflet 1.0\n* by Sumit Kumar (@TweetsOfSumit)\n* Github Repo: https://github.com/codeofsumit/leaflet.pm\n*/\n\nL.PM = L.PM || {\n    initialize: function() {\n\n        var initLayerGroup = function() {\n            this.pm = new L.PM.Edit.LayerGroup(this);\n        };\n        L.LayerGroup.addInitHook(initLayerGroup);\n\n\n        var initPolygon = function() {\n            this.pm = new L.PM.Edit.Poly(this);\n        };\n        L.Polygon.addInitHook(initPolygon);\n\n\n        var initMap = function() {\n            this.pm = new L.PM.Draw(this);\n        };\n        L.Map.addInitHook(initMap);\n\n    },\n    Edit: {}\n};\n\n// initialize leaflet.pm\nL.PM.initialize();\n","L.PM.Draw = L.Class.extend({\n\n    initialize: function(map) {\n\n        // save the map\n        this._map = map;\n\n        // define all possible shapes that can be drawn\n        this.shapes = ['Poly'];\n\n        // initiate drawing class for our shapes\n        for(var i=0; i<this.shapes.length; i++) {\n            var shape = this.shapes[i];\n            this[shape] = new L.PM.Draw[shape](this._map);\n        }\n\n    },\n    getShapes: function() {\n        // if somebody wants to know what shapes are available\n        return this.shapes;\n    },\n    enableDraw: function(shape) {\n\n        if(!shape) {\n            throw 'Error: Please pass a shape as a parameter. Possible shapes are: ' + this.getShapes().join(',');\n        }\n\n        // disable drawing for all shapes\n        this.disableDraw();\n\n        // enable draw for a shape\n        this[shape].enable();\n\n    },\n    disableDraw: function() {\n\n        // there can only be one drawing mode active at a time on a map\n        // so it doesn't matter which one should be disabled.\n        // just disable all of them\n        for(var i=0; i<this.shapes.length; i++) {\n            var shape = this.shapes[i];\n            this[shape].disable();\n        }\n\n    },\n    addControls: function() {\n        // add control buttons for our shapes\n        for(var i=0; i<this.shapes.length; i++) {\n            var shape = this.shapes[i];\n            this[shape].addButton();\n        }\n    }\n});\n","L.Control.PMButton = L.Control.extend({\n    options: {\n        position: 'topleft'\n    },\n    initialize: function (options) {\n        this._button = {};\n        this.setButton(options);\n    },\n\n    onAdd: function (map) {\n\n        this._map = map;\n        var container = L.DomUtil.create('div', 'leaflet-control-button');\n\n        this._container = container;\n\n        this._makeButton(this._button);\n        return this._container;\n    },\n\n    onRemove: function (map) {\n    },\n\n    setButton: function (options) {\n        var button = {\n            'className': options.className,\n            'iconUrl': options.iconUrl,\n            'onClick': options.onClick,\n            'afterClick': options.afterClick,\n            'doToggle': options.doToggle,\n            'toggleStatus': options.toggleStatus\n        };\n\n        this._button = button;\n    },\n\n    getText: function () {\n        return this._button.text;\n    },\n\n    getIconUrl: function () {\n        return this._button.iconUrl;\n    },\n\n    destroy: function () {\n        this._button = {};\n        this._update();\n    },\n\n    toggle: function (e) {\n        if(typeof e === 'boolean'){\n            this._button.toggleStatus = e;\n        }\n        else{\n            this._button.toggleStatus = !this._button.toggleStatus;\n        }\n    },\n    toggled: function () {\n        return this._button.toggleStatus;\n    },\n    onCreate: function() {\n        this.toggle(false);\n    },\n    _makeButton: function(button) {\n\n        var newButton = L.DomUtil.create('div', 'leaflet-buttons-control-button', this._container);\n        if(button.toggleStatus)\n            L.DomUtil.addClass(newButton,'active');\n\n        var image = L.DomUtil.create('img', 'control-icon', newButton);\n        if (button.iconUrl) {\n            image.setAttribute('src', button.iconUrl);\n        }\n        if (button.className) {\n            L.DomUtil.addClass(image, button.className);\n        }\n\n        L.DomEvent\n            .addListener(newButton, 'click', button.onClick, this)\n            .addListener(newButton, 'click', this._clicked, this)\n            .addListener(newButton, 'click', button.afterClick, this);\n\n        L.DomEvent.disableClickPropagation(newButton);\n        return newButton;\n\n    },\n\n    _clicked: function () {\n\n        if(this._button.doToggle){\n\n            if(this._button.toggleStatus) {\n                L.DomUtil.removeClass(this._container.childNodes[0],'active');\n            }\n            else {\n                L.DomUtil.addClass(this._container.childNodes[0],'active');\n            }\n            this.toggle();\n        }\n        return;\n    }\n\n});\n","L.PM.Draw.Poly = L.PM.Draw.extend({\n\n    initialize: function(map) {\n        this._map = map;\n        this._shape = 'Poly';\n    },\n    enable: function(options) {\n        // enable draw mode\n\n        this._enabled = true;\n\n        // create a new layergroup\n        this._layerGroup = new L.LayerGroup();\n        this._layerGroup.addTo(this._map);\n\n        // this is the polyLine that'll make up the polygon\n        this._polyline = L.polyline([], {color: 'red'});\n        this._layerGroup.addLayer(this._polyline);\n\n        // this is the hintline from the mouse cursor to the last marker\n        this._hintline = L.polyline([], {\n            color: 'red',\n            dashArray: [5, 5]\n        });\n        this._layerGroup.addLayer(this._hintline);\n\n\n        // change map cursor\n        this._map._container.style.cursor = 'crosshair';\n\n        // create a polygon-point on click\n        this._map.on('click', this._createPolygonPoint, this);\n\n        // sync the hintline on mousemove\n        this._map.on('mousemove', this._syncHintLine, this);\n\n        // fire drawstart event\n        this._map.fire('pm:drawstart', {shape: this._shape});\n\n    },\n    disable: function() {\n        // disable draw mode\n\n        // cancel, if drawing mode isn't even enabled\n        if(!this._enabled) {\n            return;\n        }\n\n        this._enabled = false;\n\n        // reset cursor\n        this._map._container.style.cursor = 'default';\n\n        // unbind listeners\n        this._map.off('click', this._createPolygonPoint);\n        this._map.off('mousemove', this._syncHintLine);\n\n        // remove layer\n        this._map.removeLayer(this._layerGroup);\n\n        // fire drawend event\n        this._map.fire('pm:drawend', {shape: this._shape});\n\n    },\n    enabled: function() {\n        return this._enabled;\n    },\n    toggle: function(options) {\n\n        if(this.enabled()) {\n            this.disable();\n        } else {\n            this.enable(options);\n        }\n\n    },\n    addButton: function(map) {\n\n        var self = this;\n\n        var drawPolyButton = {\n              'className': 'icon-polygon',\n              'onClick': function() {\n\n              },\n              'afterClick': function(e) {\n                  self.toggle();\n              },\n              'doToggle': true,\n              'toggleStatus': false\n        };\n\n        this._drawButton = new L.Control.PMButton(drawPolyButton).addTo(this._map);\n\n        this._map.on('pm:drawstart', function(e) {\n            if(e.shape === self._shape && !self._drawButton.toggled()) {\n                self._drawButton._clicked();\n            }\n        });\n\n        this._map.on('pm:drawend', function(e) {\n            if(e.shape === self._shape && self._drawButton.toggled()) {\n                self._drawButton._clicked();\n            }\n        });\n\n        return this._drawButton;\n\n    },\n    _syncHintLine: function(e) {\n\n        var polyPoints = this._polyline.getLatLngs();\n\n        if(polyPoints.length > 0) {\n            var lastPolygonPoint = polyPoints[polyPoints.length - 1];\n            this._hintline.setLatLngs([lastPolygonPoint, e.latlng]);\n        }\n\n\n\n    },\n    _createPolygonPoint: function(e) {\n\n        // is this the first point?\n        var first = this._polyline.getLatLngs().length === 0 ? true : false;\n\n        this._polyline.addLatLng(e.latlng);\n        this._createMarker(e.latlng, first);\n\n\n        this._hintline.setLatLngs([e.latlng, e.latlng]);\n\n    },\n    _finishPolygon: function() {\n\n        var coords = this._polyline.getLatLngs();\n        var polygonLayer = L.polygon(coords).addTo(this._map);\n\n        polygonLayer.pm.toggleEdit();\n\n        this.disable();\n\n        this._map.fire('pm:create', {\n            shape: this._shape,\n            layer: polygonLayer\n        });\n    },\n    _createMarker: function(latlng, first) {\n\n        var marker = new L.Marker(latlng, {\n            draggable: false,\n            icon: L.divIcon({className: 'marker-icon'})\n        });\n\n        this._layerGroup.addLayer(marker);\n\n        if(first) {\n            marker.on('click', this._finishPolygon, this);\n        }\n\n        return marker;\n\n    },\n});\n","L.PM.Edit.Poly = L.Class.extend({\n\n    initialize: function(poly) {\n        this._poly = poly;\n        this._enabled = false;\n    },\n\n    toggleEdit: function(options) {\n        if(!this.enabled()) {\n            this.enable(options);\n        } else {\n            this.disable();\n        }\n    },\n\n    enable: function(options) {\n\n        var self = this;\n\n        if(!this.enabled()) {\n            // change state\n            this._enabled = true;\n\n            // create markers\n            if(!this._markerGroup) {\n                this._markerGroup = new L.LayerGroup();\n\n                // init dragable markers\n                this._initMarkers();\n            }\n\n            // add markerGroup to map\n            this._poly._map.addLayer(this._markerGroup);\n\n            // if polygon gets removed from map, disable edit mode\n            this._poly.on('remove', function() {\n                self.disable();\n            });\n\n            // apply options\n            if(!options) {\n                return;\n            }\n\n            if(options.draggable) {\n                this._initDraggableLayer();\n            }\n        }\n\n    },\n\n    enabled: function() {\n        return this._enabled;\n    },\n\n    disable: function() {\n        // prevent disabling if polygon is being dragged\n        if(this.dragging()) {\n            return false;\n        }\n        this._enabled = false;\n        this._poly._map.removeLayer(this._markerGroup);\n\n        // clean up draggable\n        this._poly.off('mousedown');\n        this._poly.off('mouseup');\n\n        // remove draggable class\n        var el = this._poly._path;\n        L.DomUtil.removeClass(el, 'leaflet-pm-draggable');\n    },\n\n    dragging: function() {\n        return this._poly._dragging;\n    },\n\n    _initDraggableLayer: function() {\n\n        var that = this;\n\n        // temporary coord variable for delta calculation\n        this._tempDragCoord;\n\n        // add CSS class\n        var el = this._poly._path;\n        L.DomUtil.addClass(el, 'leaflet-pm-draggable');\n\n        this._poly.on('mousedown', function(event) {\n\n            that._tempDragCoord = event.latlng;\n\n            // listen to mousemove on map (instead of polygon), otherwise fast mouse movements stop the drag\n            that._poly._map.on('mousemove', function(e) {\n\n                // set state\n                that._poly._dragging = true;\n\n                // disbale map drag\n                that._poly._map.dragging.disable();\n\n                var latlng = e.latlng;\n\n                that._onLayerDrag(e);\n            });\n\n        });\n\n        this._poly.on('mouseup', function(e) {\n\n            // re-enable map drag\n            that._poly._map.dragging.enable();\n\n            // clear up mousemove event\n            that._poly._map.off('mousemove');\n\n            // fire edit\n            that._fireEdit();\n\n            // timeout to prevent click event after drag :-/\n            // TODO: do it better as soon as leaflet has a way to do it better :-)\n            window.setTimeout(function() {\n                // set state\n                that._poly._dragging = false;\n            }, 10)\n\n\n        });\n\n    },\n\n    _onLayerDrag: function(e) {\n\n        var that = this;\n\n        // latLng of mouse event\n        var latlng = e.latlng;\n\n        // delta coords (how far was dragged)\n        var deltaLatLng = {\n            lat: latlng.lat - that._tempDragCoord.lat,\n            lng: latlng.lng - that._tempDragCoord.lng\n        };\n\n        for(var i = 0; i < this._markers.length; i++) {\n\n            // a marker reference\n            var marker = this._markers[i];\n\n            // current coords\n            var currentLatLng = marker.getLatLng();\n\n            // new coords\n            var newLatLng = {\n                lat: currentLatLng.lat + deltaLatLng.lat,\n                lng: currentLatLng.lng + deltaLatLng.lng\n            }\n\n            // set latLng of marker\n            marker.setLatLng(newLatLng);\n\n            // act like the marker was dragged (this will move the polygon etc)\n            this._onMarkerDrag({target: marker});\n\n        }\n\n        // save current latlng for next delta calculation\n        this._tempDragCoord = latlng;\n\n\n    },\n\n    _initMarkers: function() {\n\n        this._markers = [];\n\n        var coords = this._poly._latlngs[0];\n\n        for(var i = 0; i < coords.length; i++) {\n            var marker = this._createMarker(coords[i], i);\n            this._markers.push(marker);\n        }\n\n        for(var k = 0; k < coords.length; k++) {\n\n            var nextIndex = k+1 >= coords.length ? 0 : k+1;\n\n            this._createMiddleMarker(\n                this._markers[k], this._markers[nextIndex]\n            );\n        }\n\n    },\n\n    // creates initial markers for coordinates\n    _createMarker: function(latlng, index) {\n\n        var marker = new L.Marker(latlng, {\n            draggable: true,\n            icon: L.divIcon({className: 'marker-icon'})\n        });\n\n        marker._origLatLng = latlng;\n        marker._index = index;\n\n        marker.on('drag', this._onMarkerDrag, this);\n        marker.on('dragend', this._onMarkerDragEnd, this);\n        marker.on('contextmenu', this._removeMarker, this);\n\n        this._markerGroup.addLayer(marker);\n\n        return marker;\n\n    },\n\n    // creates the middle markes between coordinates\n    _createMiddleMarker: function(leftM, rightM) {\n        var self = this;\n        var latlng = this._calcMiddleLatLng(leftM, rightM);\n\n        var middleMarker = this._createMarker(latlng);\n        var icon = L.divIcon({className: 'marker-icon marker-icon-middle'})\n        middleMarker.setIcon(icon);\n\n        // save middle markers to the other markers\n        leftM._middleMarkerRight = middleMarker;\n        rightM._middleMarkerLeft = middleMarker;\n\n        middleMarker.on('click', function() {\n\n            // TODO: move the next two lines inside _addMarker() as soon as\n            // https://github.com/Leaflet/Leaflet/issues/4484\n            // is fixed\n            var icon = L.divIcon({className: 'marker-icon'});\n            middleMarker.setIcon(icon);\n\n            self._addMarker(middleMarker, leftM, rightM);\n        });\n        middleMarker.on('movestart', function() {\n\n            // TODO: This is a workaround. Remove the moveend listener and callback as soon as this is fixed:\n            // https://github.com/Leaflet/Leaflet/issues/4484\n            middleMarker.on('moveend', function() {\n                var icon = L.divIcon({className: 'marker-icon'});\n                middleMarker.setIcon(icon);\n\n                middleMarker.off('moveend');\n            });\n\n            self._addMarker(middleMarker, leftM, rightM);\n        });\n\n\n    },\n\n    // adds a new marker from a middlemarker\n    _addMarker: function(newM, leftM, rightM) {\n\n        // first, make this middlemarker a regular marker\n        newM.off('movestart');\n        newM.off('click');\n\n        // now, create the polygon coordinate point for that marker\n        var latlng = newM.getLatLng();\n        var coords = this._poly._latlngs[0];\n        var index = leftM._index + 1;\n\n        coords.splice(index, 0, latlng);\n\n        // associate polygon coordinate with marker coordinate\n        newM._origLatLng = coords[index];\n\n        // push into marker array update the indexes for every marker\n        this._markers.splice(index, 0, newM);\n        for(var i=0;i<this._markers.length;i++) {\n            this._markers[i]._index = i;\n        }\n\n        // create the new middlemarkers\n        this._createMiddleMarker(leftM, newM);\n        this._createMiddleMarker(newM, rightM);\n\n        // fire edit event\n        this._fireEdit();\n\n\n    },\n\n    _removeMarker: function(e) {\n        var marker = e.target;\n\n        // only continue if this is NOT a middle marker (those can't be deleted)\n        if(marker._index !== undefined) {\n\n            // remove polygon coordinate from this marker\n            var coords = this._poly._latlngs[0];\n            var index = marker._index;\n\n            coords.splice(index, 1);\n            this._poly.redraw();\n\n            // remove the marker and the middlemarkers next to it from the map\n            this._markerGroup.removeLayer(marker._middleMarkerLeft);\n            this._markerGroup.removeLayer(marker._middleMarkerRight);\n            this._markerGroup.removeLayer(marker);\n\n\n            // create the new middlemarker\n            var leftMarkerIndex = index - 1 < 0 ? this._markers.length - 1 : index - 1;\n            var rightMarkerIndex = index + 1 >= this._markers.length ? 0 : index + 1;\n\n            var leftM = this._markers[leftMarkerIndex];\n            var rightM = this._markers[rightMarkerIndex];\n            this._createMiddleMarker(leftM, rightM);\n\n\n            // remove the marker from the markers array\n            this._markers.splice(index, 1);\n\n            // update the remaining markers indexes\n            for(var i=0;i<this._markers.length;i++) {\n                this._markers[i]._index = i;\n            }\n\n            // fire edit event\n            this._fireEdit();\n\n        }\n\n\n    },\n\n    _onMarkerDrag: function(e) {\n\n        // dragged marker\n        var marker = e.target;\n\n        // the dragged markers neighbors\n        var nextMarkerIndex = marker._index + 1 >= this._markers.length ? 0 : marker._index + 1;\n        var prevMarkerIndex = marker._index - 1 < 0 ? this._markers.length - 1 : marker._index - 1;\n\n        // update marker coordinates which will update polygon coordinates\n        L.extend(marker._origLatLng, marker._latlng);\n        this._poly.redraw();\n\n        // update middle markers on the left and right\n        // be aware that \"left\" and \"right\" might be interchanged, depending on the geojson array\n        // TODO rename \"left\" and \"right\" to \"prev\" and \"next\"\n        var middleMarkerRightLatLng = this._calcMiddleLatLng(marker, this._markers[nextMarkerIndex]);\n        marker._middleMarkerRight.setLatLng(middleMarkerRightLatLng);\n\n        var middleMarkerLeftLatLng = this._calcMiddleLatLng(marker, this._markers[prevMarkerIndex]);\n        marker._middleMarkerLeft.setLatLng(middleMarkerLeftLatLng);\n\n    },\n\n    _onMarkerDragEnd: function(e) {\n\n        var marker = e.target;\n\n        this._fireEdit();\n\n    },\n\n    _fireEdit: function () {\n        this._poly.edited = true;\n        this._poly.fire('pm:edit');\n    },\n\n    _calcMiddleLatLng: function(leftM, rightM) {\n        var map = this._poly._map,\n            p1 = map.project(leftM.getLatLng()),\n            p2 = map.project(rightM.getLatLng());\n\n        var latlng = map.unproject(p1._add(p2)._divideBy(2));\n\n        return latlng;\n    }\n\n});\n","\nL.PM.Edit.LayerGroup = L.Class.extend({\n    initialize: function(layerGroup) {\n        var self = this;\n        this._layerGroup = layerGroup;\n        this._layers = layerGroup.getLayers();\n\n        // listen to the edit event of the layers in this group\n        for(var i=0; i<this._layers.length; i++) {\n            this._layers[i].on('pm:edit', this._fireEdit, this);\n        }\n\n        // if a new layer is added to the group, reinitialize\n        this._layerGroup.on('layeradd', function(e) {\n            self.initialize(layerGroup);\n\n            // if editing was already enabled for this group, enable it again\n            // so the new layers are enabled\n            if(e.target.pm.enabled()) {\n                self.enable();\n            }\n        });\n    },\n    _fireEdit: function() {\n        this._layerGroup.fireEvent('pm:edit');\n    },\n    toggleEdit: function(options) {\n\n        for(var i=0; i<this._layers.length; i++) {\n            this._layers[i].pm.toggleEdit(options);\n        }\n    },\n    enable: function(options) {\n        for(var i=0; i<this._layers.length; i++) {\n            this._layers[i].pm.enable(options);\n        }\n    },\n    disable: function() {\n        for(var i=0; i<this._layers.length; i++) {\n            this._layers[i].pm.disable();\n        }\n    },\n    enabled: function() {\n\n        var enabled = false;\n\n        for(var i=0; i<this._layers.length; i++) {\n            enabled = this._layers[i].pm.enabled();\n            if(enabled) {\n                break;\n            }\n        }\n\n        return enabled;\n    }\n});\n"],"sourceRoot":"/source/"}