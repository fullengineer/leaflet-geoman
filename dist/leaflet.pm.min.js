"use strict";L.PM=L.PM||{initialize:function(){var t=function(){this.pm=new L.PM.Edit.LayerGroup(this)};L.LayerGroup.addInitHook(t);var e=function(){this.pm=new L.PM.Edit.Poly(this)};L.Polygon.addInitHook(e);var i=function(){this.pm=new L.PM.Draw(this)};L.Map.addInitHook(i)},Edit:{}},L.PM.initialize(),L.PM.Draw=L.Class.extend({initialize:function(t){this._map=t,this.shapes=["Poly"];for(var e=0;e<this.shapes.length;e++){var i=this.shapes[e];this[i]=new L.PM.Draw[i](this._map)}},getShapes:function(){return this.shapes},enableDraw:function(t){if(!t)throw"Error: Please pass a shape as a parameter. Possible shapes are: "+this.getShapes().join(",");this.disableDraw(),this[t].enable()},disableDraw:function(){for(var t=0;t<this.shapes.length;t++){var e=this.shapes[t];this[e].disable()}},addControls:function(){for(var t=0;t<this.shapes.length;t++){var e=this.shapes[t];this[e].addButton()}}}),L.Control.PMButton=L.Control.extend({options:{position:"topleft"},initialize:function(t){this._button={},this.setButton(t)},onAdd:function(t){this._map=t;var e=L.DomUtil.create("div","leaflet-control-button");return this._container=e,this._makeButton(this._button),this._container},onRemove:function(t){},setButton:function(t){var e={className:t.className,iconUrl:t.iconUrl,onClick:t.onClick,afterClick:t.afterClick,doToggle:t.doToggle,toggleStatus:t.toggleStatus};this._button=e},getText:function(){return this._button.text},getIconUrl:function(){return this._button.iconUrl},destroy:function(){this._button={},this._update()},toggle:function(t){"boolean"==typeof t?this._button.toggleStatus=t:this._button.toggleStatus=!this._button.toggleStatus},toggled:function(){return this._button.toggleStatus},onCreate:function(){this.toggle(!1)},_makeButton:function(t){var e=L.DomUtil.create("div","leaflet-buttons-control-button",this._container);t.toggleStatus&&L.DomUtil.addClass(e,"active");var i=L.DomUtil.create("img","control-icon",e);return t.iconUrl&&i.setAttribute("src",t.iconUrl),t.className&&L.DomUtil.addClass(i,t.className),L.DomEvent.addListener(e,"click",t.onClick,this).addListener(e,"click",this._clicked,this).addListener(e,"click",t.afterClick,this),L.DomEvent.disableClickPropagation(e),e},_clicked:function(){this._button.doToggle&&(this._button.toggleStatus?L.DomUtil.removeClass(this._container.childNodes[0],"active"):L.DomUtil.addClass(this._container.childNodes[0],"active"),this.toggle())}}),L.PM.Draw.Poly=L.PM.Draw.extend({initialize:function(t){this._map=t,this._shape="Poly"},enable:function(t){this._enabled=!0,this._layerGroup=new L.LayerGroup,this._layerGroup.addTo(this._map),this._polyline=L.polyline([],{color:"red"}),this._layerGroup.addLayer(this._polyline),this._hintline=L.polyline([],{color:"red",dashArray:[5,5]}),this._layerGroup.addLayer(this._hintline),this._map._container.style.cursor="crosshair",this._map.on("click",this._createPolygonPoint,this),this._map.on("mousemove",this._syncHintLine,this),this._map.fire("pm:drawstart",{shape:this._shape})},disable:function(){this._enabled&&(this._enabled=!1,this._map._container.style.cursor="default",this._map.off("click",this._createPolygonPoint),this._map.off("mousemove",this._syncHintLine),this._map.removeLayer(this._layerGroup),this._map.fire("pm:drawend",{shape:this._shape}))},enabled:function(){return this._enabled},toggle:function(t){this.enabled()?this.disable():this.enable(t)},addButton:function(t){var e=this,i={className:"icon-polygon",onClick:function(){},afterClick:function(t){e.toggle()},doToggle:!0,toggleStatus:!1};return this._drawButton=new L.Control.PMButton(i).addTo(this._map),this._map.on("pm:drawstart",function(t){t.shape!==e._shape||e._drawButton.toggled()||e._drawButton._clicked()}),this._map.on("pm:drawend",function(t){t.shape===e._shape&&e._drawButton.toggled()&&e._drawButton._clicked()}),this._drawButton},_syncHintLine:function(t){var e=this._polyline.getLatLngs();if(e.length>0){var i=e[e.length-1];this._hintline.setLatLngs([i,t.latlng])}},_createPolygonPoint:function(t){var e=0===this._polyline.getLatLngs().length?!0:!1;this._polyline.addLatLng(t.latlng),this._createMarker(t.latlng,e),this._hintline.setLatLngs([t.latlng,t.latlng])},_finishPolygon:function(){var t=this._polyline.getLatLngs(),e=L.polygon(t).addTo(this._map);e.pm.toggleEdit(),this.disable(),this._map.fire("pm:create",{shape:this._shape,layer:e})},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._layerGroup.addLayer(i),e&&i.on("click",this._finishPolygon,this),i}}),L.PM.Edit.Poly=L.Class.extend({initialize:function(t){this._poly=t,this._enabled=!1},toggleEdit:function(t){this.enabled()?this.disable():this.enable(t)},enable:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=this;if(this.options=t,!this.enabled()){if(this._enabled=!0,this._initMarkers(),this._poly.on("remove",e.disable),!t)return;void 0===window.turf&&this.options.preventOverlap&&(console.warn("TurfJS not found, preventOverlap is deactivated"),this.options.preventOverlap=!1),this.options.draggable&&this._initDraggableLayer()}},enabled:function(){return this._enabled},disable:function(){if(this.dragging())return!1;this._enabled=!1,this._poly._map.removeLayer(this._markerGroup),this._poly.off("mousedown"),this._poly.off("mouseup");var t=this._poly._path;L.DomUtil.removeClass(t,"leaflet-pm-draggable")},dragging:function(){return this._poly._dragging},_initDraggableLayer:function(){var t=this;this._tempDragCoord;var e=this._poly._path;L.DomUtil.addClass(e,"leaflet-pm-draggable");var i=function(i){t._poly._map.dragging.enable(),t._poly._map.off("mousemove"),t._poly.off("mouseup"),t._initMarkers(),t._applyPossibleCoordsChanges(),window.setTimeout(function(){t._poly._dragging=!1,L.DomUtil.removeClass(e,"leaflet-pm-dragging"),t._poly.fire("pm:dragend"),t._fireEdit()},10)},a=function(i){t._poly._dragging||(t._poly._dragging=!0,L.DomUtil.addClass(e,"leaflet-pm-dragging"),t._poly.bringToFront(),t._poly._map.dragging.disable(),t._markerGroup.clearLayers(),t._poly.fire("pm:dragstart")),t._onLayerDrag(i)};this._poly.on("mousedown",function(e){t._tempDragCoord=e.latlng,t._poly.on("mouseup",i),t._poly._map.on("mousemove",a)})},_onLayerDrag:function(t){for(var e=this,i=t.latlng,a={lat:i.lat-e._tempDragCoord.lat,lng:i.lng-e._tempDragCoord.lng},r=[],n=0;n<this._poly._latlngs[0].length;n++){var o=this._poly._latlngs[0][n],s={lat:o.lat+a.lat,lng:o.lng+a.lng};r.push(s)}this._poly.setLatLngs(r).redraw(),this._tempDragCoord=i,this.options.preventOverlap&&this._handleOverlap(),this._poly.fire("pm:drag")},_initMarkers:function(){var t=this,e=this._poly._map;this._markerGroup&&this._markerGroup.clearLayers(),this._markerGroup=new L.LayerGroup,e.addLayer(this._markerGroup);var i=this._poly._latlngs[0];this._markers=i.map(function(e,i){return t._createMarker(e,i)});for(var a=0;a<i.length;a++){var r=a+1>=i.length?0:a+1;this._createMiddleMarker(this._markers[a],this._markers[r])}},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return i._origLatLng=t,i._index=e,i.on("drag",this._onMarkerDrag,this),i.on("dragend",this._onMarkerDragEnd,this),i.on("contextmenu",this._removeMarker,this),this._markerGroup.addLayer(i),i},_createMiddleMarker:function(t,e){var i=this,a=this._calcMiddleLatLng(t.getLatLng(),e.getLatLng()),r=this._createMarker(a),n=L.divIcon({className:"marker-icon marker-icon-middle"});r.setIcon(n),t._middleMarkerNext=r,e._middleMarkerPrev=r,r.on("click",function(){var a=L.divIcon({className:"marker-icon"});r.setIcon(a),i._addMarker(r,t,e)}),r.on("movestart",function(){r.on("moveend",function(){var t=L.divIcon({className:"marker-icon"});r.setIcon(t),r.off("moveend")}),i._addMarker(r,t,e)})},_addMarker:function(t,e,i){t.off("movestart"),t.off("click");var a=t.getLatLng(),r=this._poly._latlngs[0],n=e._index+1;r.splice(n,0,a),t._origLatLng=r[n],this._markers.splice(n,0,t);for(var o=0;o<this._markers.length;o++)this._markers[o]._index=o;this._createMiddleMarker(e,t),this._createMiddleMarker(t,i),this._fireEdit()},_removeMarker:function(t){var e=t.target;if(void 0!==e._index){var i=this._poly._latlngs[0],a=e._index;i.splice(a,1),this._poly.redraw(),this._markerGroup.removeLayer(e._middleMarkerPrev),this._markerGroup.removeLayer(e._middleMarkerNext),this._markerGroup.removeLayer(e);var r=0>a-1?this._markers.length-1:a-1,n=a+1>=this._markers.length?0:a+1,o=this._markers[r],s=this._markers[n];this._createMiddleMarker(o,s),this._markers.splice(a,1);for(var l=0;l<this._markers.length;l++)this._markers[l]._index=l;this.options.preventOverlap&&(this._handleOverlap(),this._applyPossibleCoordsChanges()),this._fireEdit()}},_applyPossibleCoordsChanges:function(){if(this._tempPolygon){var t=this._tempPolygon.getLayers()[0].getLatLngs();this._poly.setLatLngs(t).redraw(),this._initMarkers()}},_drawTemporaryPolygon:function(t){this._poly.setStyle({opacity:0,fillOpacity:0}),this._tempPolygon=L.geoJson(t).addTo(this._poly._map).bringToBack()},_handleOverlap:function(){for(var t=this._layerGroup.getLayers(),e=!1,i=this._poly.toGeoJSON(),a=0;a<t.length;a++){var r=t[a];if(r!==this._poly){var n;try{n=turf.intersect(i,r.toGeoJSON())}catch(o){console.warn("Turf Error :-/")}n&&(i=turf.difference(i,r.toGeoJSON()),"MultiPolygon"!==i.geometry.type&&(e=!0))}}this._tempPolygon&&(this._tempPolygon.remove(),delete this._tempPolygon),e?this._drawTemporaryPolygon(i):this._poly.setStyle({opacity:1,fillOpacity:.2})},_onMarkerDrag:function(t){var e=t.target,i=e._index+1>=this._markers.length?0:e._index+1,a=e._index-1<0?this._markers.length-1:e._index-1;L.extend(e._origLatLng,e._latlng),this._poly.redraw();var r=e.getLatLng(),n=this._markers[a].getLatLng(),o=this._markers[i].getLatLng(),s=this._calcMiddleLatLng(r,o);e._middleMarkerNext.setLatLng(s);var l=this._calcMiddleLatLng(r,n);e._middleMarkerPrev.setLatLng(l),this.options.preventOverlap&&this._handleOverlap()},_onMarkerDragEnd:function(t){t.target;this._applyPossibleCoordsChanges(),this._fireEdit()},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("pm:edit")},_calcMiddleLatLng:function(t,e){var i=this._poly._map,a=i.project(t),r=i.project(e),n=i.unproject(a._add(r)._divideBy(2));return n}}),L.PM.Edit.LayerGroup=L.Class.extend({initialize:function(t){var e=this;this._layerGroup=t,this._layers=t.getLayers();for(var i=0;i<this._layers.length;i++)this._layers[i].on("pm:edit",this._fireEdit,this),this._layers[i].on("pm:dragstart",this._fireDragstart,this),this._layers[i].on("pm:drag",this._fireDrag,this),this._layers[i].on("pm:dragend",this._fireDragend,this),this._layers[i].pm._layerGroup=this._layerGroup;this._layerGroup.on("layeradd",function(i){e.initialize(t),i.target.pm.enabled()&&e.enable()})},_fireEdit:function(){this._layerGroup.fireEvent("pm:edit")},_fireDragstart:function(){this._layerGroup.fireEvent("pm:dragstart")},_fireDrag:function(){this._layerGroup.fireEvent("pm:drag")},_fireDragend:function(){this._layerGroup.fireEvent("pm:dragend")},toggleEdit:function(t){for(var e=0;e<this._layers.length;e++)this._layers[e].pm.toggleEdit(t)},enable:function(t){for(var e=0;e<this._layers.length;e++)this._layers[e].pm.enable(t)},disable:function(){for(var t=0;t<this._layers.length;t++)this._layers[t].pm.disable()},enabled:function t(){for(var t=!1,e=0;e<this._layers.length&&!(t=this._layers[e].pm.enabled());e++);return t}});
//# sourceMappingURL=maps/leaflet.pm.min.js.map
